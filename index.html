<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Estação da Terra - Loja</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <header class="header" role="banner">
    <h1 class="logo">Estação da Terra</h1>
    <nav class="nav" role="navigation" aria-label="Menu principal">
      <a href="index.html" class="nav-link active" aria-current="page">Loja</a>
      <a href="quiz.html" class="nav-link">Quiz</a>
      <a href="sobre.html" class="nav-link">Sobre</a>
      <a href="contato.html" class="nav-link">Contato</a>
      <button id="btn-libras" aria-label="Ativar vídeo em Libras">Libras</button>
    </nav>
  </header>

  <main class="main-content" role="main">
    <section class="loja-section" aria-label="Lista de produtos do campo">
      <h2>Produtos do Campo</h2>
      <div class="produtos-grid" id="produtos-grid">
        <!-- Os produtos serão inseridos aqui pelo JS -->
      </div>

      <aside class="carrinho" aria-label="Carrinho de compras" role="region">
        <h3>Carrinho</h3>
        <ul id="lista-carrinho" aria-live="polite" aria-relevant="additions removals"></ul>
        <p id="total-carrinho" aria-atomic="true">Total: R$ 0,00</p>
        <button id="btn-esvaziar" disabled aria-disabled="true">Esvaziar Carrinho</button>
        <button id="btn-finalizar" disabled aria-disabled="true">Finalizar Compra</button>
      </aside>
    </section>
  </main>

  <!-- Modal Libras -->
  <div id="modal-libras" class="modal-libras" role="dialog" aria-modal="true" aria-labelledby="modal-libras-titulo" hidden>
    <div class="modal-content">
      <h2 id="modal-libras-titulo">Vídeo em Libras</h2>
      <button id="btn-fechar-libras" aria-label="Fechar vídeo Libras">X</button>
      <video controls width="320" height="240" src="videos/libras-intro.mp4" aria-describedby="modal-libras-titulo"></video>
    </div>
  </div>

  <script>
    // Lista dos produtos - agora 13 produtos
    const produtos = [
      { nome: 'Maçã Orgânica', preco: 3.00, img: 'img/maça.jpg' },
      { nome: 'Mel Puro', preco: 15.00, img: 'img/mel.jpg' },
      { nome: 'Banana', preco: 2.50, img: 'img/banana.jpg' },
      { nome: 'Tomate', preco: 4.00, img: 'img/tomate.jpg' },
      { nome: 'Cenoura', preco: 3.20, img: 'img/cenoura.jpg' },
      { nome: 'Leite Integral', preco: 6.50, img: 'img/leite.jpg' },
      { nome: 'Queijo Minas', preco: 22.00, img: 'img/queijo.jpg' },
      { nome: 'Arroz Integral', preco: 10.00, img: 'img/arroz.jpg' },
      { nome: 'Feijão Preto', preco: 8.00, img: 'img/feijao.jpg' },
      { nome: 'Abacate', preco: 5.00, img: 'img/abacate.jpg' },
      { nome: 'Batata Doce', preco: 4.50, img: 'img/batatadoce.jpg' },
      { nome: 'Alface', preco: 2.80, img: 'img/alface.jpg' },
      { nome: 'Pão de Queijo', preco: 12.00, img: 'img/paodequeijo.jpg' }
    ];

    const carrinho = [];
    const produtosGrid = document.getElementById('produtos-grid');
    const listaCarrinho = document.getElementById('lista-carrinho');
    const totalCarrinho = document.getElementById('total-carrinho');
    const btnEsvaziar = document.getElementById('btn-esvaziar');
    const btnFinalizar = document.getElementById('btn-finalizar');

    // Renderiza os produtos na página
    function renderizarProdutos() {
      produtosGrid.innerHTML = '';
      produtos.forEach((produto, index) => {
        const card = document.createElement('article');
        card.className = 'produto-card';
        card.setAttribute('tabindex', '0');
        card.setAttribute('aria-label', `${produto.nome}, preço R$ ${produto.preco.toFixed(2)}`);

        card.innerHTML = `
          <img src="${produto.img}" alt="${produto.nome}" />
          <h3>${produto.nome}</h3>
          <p class="preco">R$ ${produto.preco.toFixed(2)}</p>
          <button class="btn-adicionar" aria-label="Adicionar ${produto.nome} ao carrinho">Adicionar ao Carrinho</button>
        `;

        const btnAdicionar = card.querySelector('button');
        btnAdicionar.addEventListener('click', () => adicionarAoCarrinho(index));

        produtosGrid.appendChild(card);
      });
    }

    // Atualiza a lista do carrinho e total
    function atualizarCarrinho() {
      listaCarrinho.innerHTML = '';
      let total = 0;

      carrinho.forEach((item, i) => {
        const li = document.createElement('li');
        li.className = 'item-carrinho';
        li.setAttribute('tabindex', '0');
        li.innerHTML = `
          ${item.nome} - R$ ${item.preco.toFixed(2)} x ${item.quantidade}
          <button class="btn-remover" aria-label="Remover ${item.nome} do carrinho">✕</button>
          <button class="btn-mais" aria-label="Adicionar mais ${item.nome}">+</button>
          <button class="btn-menos" aria-label="Diminuir quantidade de ${item.nome}">-</button>
        `;

        // Remover item
        li.querySelector('.btn-remover').addEventListener('click', () => {
          carrinho.splice(i, 1);
          atualizarCarrinho();
        });

        // Aumentar quantidade
        li.querySelector('.btn-mais').addEventListener('click', () => {
          carrinho[i].quantidade++;
          atualizarCarrinho();
        });

        // Diminuir quantidade
        li.querySelector('.btn-menos').addEventListener('click', () => {
          if (carrinho[i].quantidade > 1) {
            carrinho[i].quantidade--;
          } else {
            carrinho.splice(i, 1);
          }
          atualizarCarrinho();
        });

        listaCarrinho.appendChild(li);
        total += item.preco * item.quantidade;
      });

      totalCarrinho.textContent = `Total: R$ ${total.toFixed(2)}`;
      btnEsvaziar.disabled = carrinho.length === 0;
      btnFinalizar.disabled = carrinho.length === 0;

      btnEsvaziar.setAttribute('aria-disabled', btnEsvaziar.disabled);
      btnFinalizar.setAttribute('aria-disabled', btnFinalizar.disabled);
    }

    // Adiciona produto ao carrinho (se já existe, aumenta a quantidade)
    function adicionarAoCarrinho(indexProduto) {
      const produto = produtos[indexProduto];
      const itemExistente = carrinho.find(item => item.nome === produto.nome);

      if (itemExistente) {
        itemExistente.quantidade++;
      } else {
        carrinho.push({ nome: produto.nome, preco: produto.preco, quantidade: 1 });
      }

      atualizarCarrinho();
      alert(`${produto.nome} adicionado ao carrinho!`);
    }

    // Eventos dos botões do carrinho
    btnEsvaziar.addEventListener('click', () => {
      if (confirm('Deseja esvaziar o carrinho?')) {
        carrinho.length = 0;
        atualizarCarrinho();
      }
    });

    btnFinalizar.addEventListener('click', () => {
      if (carrinho.length === 0) {
        alert('O carrinho está vazio!');
        return;
      }
      alert('Compra finalizada! Obrigado pela preferência.');
      carrinho.length = 0;
      atualizarCarrinho();
    });

    // Modal Libras
    const btnLibras = document.getElementById('btn-libras');
    const modalLibras = document.getElementById('modal-libras');
    const btnFecharLibras = document.getElementById('btn-fechar-libras');

    btnLibras.addEventListener('click', () => {
      modalLibras.hidden = false;
      modalLibras.querySelector('video').play();
      btnFecharLibras.focus();
    });

    btnFecharLibras.addEventListener('click', () => {
      modalLibras.hidden = true;
      modalLibras.querySelector('video').pause();
      btnLibras.focus();
    });

    // Fechar modal com ESC
    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !modalLibras.hidden) {
        modalLibras.hidden = true;
        modalLibras.querySelector('video').pause();
        btnLibras.focus();
      }
    });

    // Inicializa
    renderizarProdutos();
    atualizarCarrinho();
  </script>

</body>
</html>
