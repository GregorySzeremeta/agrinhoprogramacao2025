<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Esta√ß√£o da Terra - Produtos do Campo</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1 tabindex="0">Esta√ß√£o da Terra</h1>
    <p tabindex="0" class="slogan">Do campo √† cidade, colhendo oportunidades</p>
    <nav aria-label="Menu principal">
      <ul class="menu" role="menubar">
        <li role="none"><button role="menuitem" id="btnLoja" tabindex="0">Loja</button></li>
        <li role="none"><button role="menuitem" id="btnQuiz" tabindex="0">Quiz</button></li>
        <li role="none"><button role="menuitem" id="btnContato" tabindex="0">Contato</button></li>
      </ul>
    </nav>
    <div class="accessibility-controls" aria-label="Controles de acessibilidade">
      <button id="btnIncreaseFont" aria-pressed="false" aria-label="Aumentar fonte">A+</button>
      <button id="btnDecreaseFont" aria-pressed="false" aria-label="Diminuir fonte">A-</button>
      <button id="btnContrast" aria-pressed="false" aria-label="Ativar modo alto contraste">Contraste</button>
      <button id="btnLibras" aria-pressed="false" aria-label="Ativar tradu√ß√£o em LIBRAS">LIBRAS</button>
      <button id="btnSom" aria-pressed="false" aria-label="Ativar som ambiente de mato">Som Mato</button>
    </div>
  </header>

  <main id="mainContent" tabindex="0">
    <!-- Conte√∫do din√¢mico ser√° inserido aqui -->
  </main>

  <!-- Bot√£o do carrinho -->
  <button id="cartBtn" aria-label="Abrir carrinho de compras" aria-haspopup="dialog" aria-controls="cartDialog" aria-expanded="false">
    üõí <span id="cartCount" aria-live="polite" aria-atomic="true">0</span>
  </button>

  <!-- Di√°logo do carrinho -->
  <dialog id="cartDialog" aria-modal="true" aria-labelledby="cartTitle">
    <h2 id="cartTitle">Seu Carrinho</h2>
    <div id="cartItems" tabindex="0" aria-live="polite"></div>
    <p id="cartTotal" tabindex="0"></p>
    <div class="cart-buttons">
      <button id="emptyCartBtn">Esvaziar Carrinho</button>
      <button id="checkoutBtn">Finalizar Compra</button>
      <button id="closeCartBtn">Fechar</button>
    </div>
  </dialog>

  <!-- Container do quiz -->
  <section id="quizSection" hidden aria-live="polite" aria-atomic="true">
    <h2>Quiz: Conhecimentos sobre Produ√ß√£o do Campo</h2>
    <div id="quizQuestion"></div>
    <div id="quizOptions"></div>
    <p id="quizResult" aria-live="assertive"></p>
    <button id="quizNextBtn" disabled>Pr√≥xima</button>
    <button id="quizRestartBtn" hidden>Reiniciar Quiz</button>
  </section>

  <!-- Contato simples -->
  <section id="contatoSection" hidden>
    <h2>Contato</h2>
    <form id="contatoForm" aria-label="Formul√°rio de contato">
      <label for="nome">Nome:</label>
      <input type="text" id="nome" name="nome" required />
      <label for="email">E-mail:</label>
      <input type="email" id="email" name="email" required />
      <label for="mensagem">Mensagem:</label>
      <textarea id="mensagem" name="mensagem" rows="4" required></textarea>
      <button type="submit">Enviar</button>
    </form>
    <p id="contatoFeedback" role="alert" aria-live="assertive"></p>
  </section>

  <!-- √Åudio para som ambiente -->
  <audio id="somMato" loop>
    <source src="https://cdn.pixabay.com/download/audio/2022/08/24/audio_c9ef5f960d.mp3?filename=forest-ambience-110113.mp3" type="audio/mpeg" />
    Seu navegador n√£o suporta √°udio.
  </audio>

  <script>
    'use strict';

    // Produtos do campo - array com 30 produtos
    const produtos = [
      { id: 1, nome: 'Leite Fresco', categoria: 'Latic√≠nios', preco: 4.50 },
      { id: 2, nome: 'Queijo Minas', categoria: 'Latic√≠nios', preco: 20.00 },
      { id: 3, nome: 'Manteiga', categoria: 'Latic√≠nios', preco: 12.00 },
      { id: 4, nome: 'Mel Natural', categoria: 'Mel', preco: 15.00 },
      { id: 5, nome: 'Ma√ß√£', categoria: 'Frutas', preco: 3.50 },
      { id: 6, nome: 'Banana', categoria: 'Frutas', preco: 2.80 },
      { id: 7, nome: 'Laranja', categoria: 'Frutas', preco: 3.00 },
      { id: 8, nome: 'Tomate', categoria: 'Verduras', preco: 4.00 },
      { id: 9, nome: 'Alface', categoria: 'Verduras', preco: 2.50 },
      { id: 10, nome: 'Cenoura', categoria: 'Verduras', preco: 3.00 },
      { id: 11, nome: 'Feij√£o Preto', categoria: 'Gr√£os', preco: 8.00 },
      { id: 12, nome: 'Arroz Integral', categoria: 'Gr√£os', preco: 6.50 },
      { id: 13, nome: 'Trigo', categoria: 'Gr√£os', preco: 5.00 },
      { id: 14, nome: 'Sementes de Ab√≥bora', categoria: 'Sementes', preco: 7.00 },
      { id: 15, nome: 'Sementes de Girassol', categoria: 'Sementes', preco: 6.00 },
      { id: 16, nome: 'Morango', categoria: 'Frutas', preco: 10.00 },
      { id: 17, nome: 'Abacate', categoria: 'Frutas', preco: 7.50 },
      { id: 18, nome: 'Pepino', categoria: 'Verduras', preco: 3.20 },
      { id: 19, nome: 'Alho', categoria: 'Verduras', preco: 15.00 },
      { id: 20, nome: 'Cebola', categoria: 'Verduras', preco: 3.80 },
      { id: 21, nome: 'Leite de Cabra', categoria: 'Latic√≠nios', preco: 5.00 },
      { id: 22, nome: 'Queijo Coalho', categoria: 'Latic√≠nios', preco: 25.00 },
      { id: 23, nome: 'Mel Silvestre', categoria: 'Mel', preco: 18.00 },
      { id: 24, nome: 'Ab√≥bora', categoria: 'Verduras', preco: 4.50 },
      { id: 25, nome: 'Batata Doce', categoria: 'Verduras', preco: 3.30 },
      { id: 26, nome: 'Amendoim', categoria: 'Gr√£os', preco: 9.00 },
      { id: 27, nome: 'Milho Verde', categoria: 'Gr√£os', preco: 5.50 },
      { id: 28, nome: 'Ch√° de Ervas', categoria: 'Outros', preco: 12.00 },
      { id: 29, nome: 'Farinha de Mandioca', categoria: 'Outros', preco: 7.00 },
      { id: 30, nome: '√ìleo de Coco', categoria: 'Outros', preco: 20.00 }
    ];

    // Quiz perguntas
    const quizPerguntas = [
      {
        pergunta: 'Qual a melhor √©poca para plantar milho?',
        opcoes: ['Primavera', 'Ver√£o', 'Outono', 'Inverno'],
        correta: 0
      },
      {
        pergunta: 'O que √© agricultura org√¢nica?',
        opcoes: ['Uso de agrot√≥xicos', 'Uso de t√©cnicas naturais', 'Uso de sementes transg√™nicas', 'Uso de fertilizantes qu√≠micos'],
        correta: 1
      },
      {
        pergunta: 'Qual animal √© mais comum na produ√ß√£o leiteira?',
        opcoes: ['Gado bovino', 'Porco', 'Ovelha', 'Galinha'],
        correta: 0
      },
      {
        pergunta: 'Qual √© o principal benef√≠cio do plantio direto?',
        opcoes: ['Evita eros√£o', 'Diminui produ√ß√£o', 'Aumenta eros√£o', 'Aumenta custo'],
        correta: 0
      },
      {
        pergunta: 'Qual dessas sementes √© oleaginosa?',
        opcoes: ['Feij√£o', 'Milho', 'Soja', 'Arroz'],
        correta: 2
      },
      {
        pergunta: 'Qual fruta √© mais rica em vitamina C?',
        opcoes: ['Banana', 'Laranja', 'Ma√ß√£', 'Melancia'],
        correta: 1
      },
      {
        pergunta: 'O que √© irriga√ß√£o?',
        opcoes: ['Plantio manual', 'Aduba√ß√£o qu√≠mica', 'Aplica√ß√£o de √°gua', 'Colheita mecanizada'],
        correta: 2
      },
      {
        pergunta: 'Qual a fun√ß√£o do composto org√¢nico no solo?',
        opcoes: ['Fertilizante qu√≠mico', 'Aumentar a mat√©ria org√¢nica', 'Eliminar pragas', 'Matar ervas daninhas'],
        correta: 1
      },
      {
        pergunta: 'Qual gr√£o √© base da alimenta√ß√£o brasileira?',
        opcoes: ['Arroz', 'Milho', 'Feij√£o', 'Soja'],
        correta: 2
      },
      {
        pergunta: 'O que significa sustentabilidade na agricultura?',
        opcoes: ['Uso intenso de qu√≠micos', 'Explora√ß√£o sem limites', 'Equil√≠brio ambiental e social', 'Desmatamento'],
        correta: 2
      }
    ];

    // Vari√°veis globais
    let carrinho = [];
    let fontSize = 16; // base em px
    let contrasteAtivo = false;
    let librasAtivo = false;
    let somAtivo = false;

    // Elementos DOM
    const mainContent = document.getElementById('mainContent');
    const btnLoja = document.getElementById('btnLoja');
    const btnQuiz = document.getElementById('btnQuiz');
    const btnContato = document.getElementById('btnContato');
    const cartBtn = document.getElementById('cartBtn');
    const cartCount = document.getElementById('cartCount');
    const cartDialog = document.getElementById('cartDialog');
    const cartItems = document.getElementById('cartItems');
    const cartTotal = document.getElementById('cartTotal');
    const emptyCartBtn = document.getElementById('emptyCartBtn');
    const closeCartBtn = document.getElementById('closeCartBtn');
    const checkoutBtn = document.getElementById('checkoutBtn');
    const quizSection = document.getElementById('quizSection');
    const quizQuestion = document.getElementById('quizQuestion');
    const quizOptions = document.getElementById('quizOptions');
    const quizResult = document.getElementById('quizResult');
    const quizNextBtn = document.getElementById('quizNextBtn');
    const quizRestartBtn = document.getElementById('quizRestartBtn');
    const contatoSection = document.getElementById('contatoSection');
    const contatoForm = document.getElementById('contatoForm');
    const contatoFeedback = document.getElementById('contatoFeedback');
    const btnIncreaseFont = document.getElementById('btnIncreaseFont');
    const btnDecreaseFont = document.getElementById('btnDecreaseFont');
    const btnContrast = document.getElementById('btnContrast');
    const btnLibras = document.getElementById('btnLibras');
    const btnSom = document.getElementById('btnSom');
    const somMato = document.getElementById('somMato');

    // --- Fun√ß√µes ---

    // Renderiza a loja com produtos por categoria
    function renderLoja() {
      quizSection.hidden = true;
      contatoSection.hidden = true;
      mainContent.hidden = false;

      // Agrupa produtos por categoria
      const categorias = {};
      produtos.forEach(p => {
        if (!categorias[p.categoria]) categorias[p.categoria] = [];
        categorias[p.categoria].push(p);
      });

      let html = '';
      for (const categoria in categorias) {
        html += `<section aria-label="Categoria ${categoria}"><h2>${categoria}</h2><ul class="produtos-lista">`;
        categorias[categoria].forEach(prod => {
          html += `
          <li class="produto-item" tabindex="0" role="group" aria-label="${prod.nome}, pre√ßo R$ ${prod.preco.toFixed(2)}">
            <div class="produto-nome">${prod.nome}</div>
            <div class="produto-preco">R$ ${prod.preco.toFixed(2)}</div>
            <button class="addCartBtn" data-id="${prod.id}" aria-label="Adicionar ${prod.nome} ao carrinho">Adicionar</button>
          </li>`;
        });
        html += `</ul></section>`;
      }
      mainContent.innerHTML = html;

      // Adiciona eventos aos bot√µes adicionar
      document.querySelectorAll('.addCartBtn').forEach(btn => {
        btn.onclick = () => {
          const id = Number(btn.dataset.id);
          adicionarAoCarrinho(id);
        };
      });
    }

    // Adiciona produto ao carrinho
    function adicionarAoCarrinho(id) {
      const prod = produtos.find(p => p.id === id);
      if (!prod) return;
      const itemCarrinho = carrinho.find(i => i.id === id);
      if (itemCarrinho) {
        itemCarrinho.quantidade++;
      } else {
        carrinho.push({ ...prod, quantidade: 1 });
      }
      atualizarContadorCarrinho();
      alert(`Produto "${prod.nome}" adicionado ao carrinho.`);
    }

    // Atualiza contador no bot√£o do carrinho
    function atualizarContadorCarrinho() {
      const total = carrinho.reduce((acc, item) => acc + item.quantidade, 0);
      cartCount.textContent = total;
      cartBtn.setAttribute('aria-label', `Abrir carrinho de compras. Voc√™ tem ${total} item${total !== 1 ? 's' : ''} no carrinho.`);
    }

    // Abre di√°logo do carrinho
    function abrirCarrinho() {
      if (cartDialog.open) return;
      atualizarCarrinhoUI();
      cartDialog.showModal();
      cartBtn.setAttribute('aria-expanded', 'true');
      // Foca no di√°logo
      cartDialog.focus();
    }

    // Atualiza UI do carrinho
    function atualizarCarrinhoUI() {
      if (carrinho.length === 0) {
        cartItems.innerHTML = '<p>Seu carrinho est√° vazio.</p>';
        cartTotal.textContent = '';
        checkoutBtn.disabled = true;
        emptyCartBtn.disabled = true;
      } else {
        checkoutBtn.disabled = false;
        emptyCartBtn.disabled = false;
        let html = '<ul>';
        let total = 0;
        carrinho.forEach(item => {
          html += `<li>${item.nome} x ${item.quantidade} - R$ ${(item.preco * item.quantidade).toFixed(2)}</li>`;
          total += item.preco * item.quantidade;
        });
        html += '</ul>';
        cartItems.innerHTML = html;
        cartTotal.textContent = `Total: R$ ${total.toFixed(2)}`;
      }
    }

    // Esvazia o carrinho
    function esvaziarCarrinho() {
      if(confirm('Deseja realmente esvaziar o carrinho?')) {
        carrinho = [];
        atualizarContadorCarrinho();
        atualizarCarrinhoUI();
      }
    }

    // Fecha di√°logo do carrinho
    function fecharCarrinho() {
      cartDialog.close();
      cartBtn.setAttribute('aria-expanded', 'false');
      cartBtn.focus();
    }

    // Finalizar compra (simula√ß√£o)
    function finalizarCompra() {
      if (carrinho.length === 0) {
        alert('Seu carrinho est√° vazio.');
        return;
      }
      alert('Compra finalizada com sucesso! Obrigado pela prefer√™ncia.');
      carrinho = [];
      atualizarContadorCarrinho();
      atualizarCarrinhoUI();
      fecharCarrinho();
    }

    // --- Quiz ---

    let quizIndex = 0;
    let quizAcertos = 0;

    function iniciarQuiz() {
      mainContent.hidden = true;
      contatoSection.hidden = true;
      quizSection.hidden = false;
      quizIndex = 0;
      quizAcertos = 0;
      quizResult.textContent = '';
      quizNextBtn.disabled = true;
      quizRestartBtn.hidden = true;
      mostrarPergunta();
    }

    function mostrarPergunta() {
      const q = quizPerguntas[quizIndex];
      quizQuestion.textContent = `Pergunta ${quizIndex + 1}: ${q.pergunta}`;
      quizOptions.innerHTML = '';
      q.opcoes.forEach((opcao, i) => {
        const btn = document.createElement('button');
        btn.textContent = opcao;
        btn.className = 'quizOptionBtn';
        btn.onclick = () => responder(i);
        quizOptions.appendChild(btn);
      });
    }

    function responder(indice) {
      const correta = quizPerguntas[quizIndex].correta;
      const botoes = [...quizOptions.children];
      botoes.forEach((btn, i) => {
        btn.disabled = true;
        if (i === correta) {
          btn.classList.add('correta');
        }
        if (i === indice && i !== correta) {
          btn.classList.add('errada');
        }
      });
      if (indice === correta) {
        quizAcertos++;
        quizResult.textContent = 'Resposta correta! üéâ';
      } else {
        quizResult.textContent = 'Resposta errada.';
      }
      quizNextBtn.disabled = false;
      if (quizIndex === quizPerguntas.length - 1) {
        quizNextBtn.textContent = 'Ver Resultado';
      } else {
        quizNextBtn.textContent = 'Pr√≥xima';
      }
    }

    quizNextBtn.onclick = () => {
      quizIndex++;
      quizResult.textContent = '';
      quizNextBtn.disabled = true;
      if (quizIndex < quizPerguntas.length) {
        mostrarPergunta();
      } else {
        mostrarResultadoQuiz();
      }
    };

    function mostrarResultadoQuiz() {
      quizQuestion.textContent = `Voc√™ acertou ${quizAcertos} de ${quizPerguntas.length} perguntas! (${((quizAcertos/quizPerguntas.length)*100).toFixed(0)}%)`;
      quizOptions.innerHTML = '';
      quizNextBtn.hidden = true;
      quizRestartBtn.hidden = false;
      // Confete simples com emojis
      quizResult.textContent = 'üéâüéâ Parab√©ns! üéâüéâ';
    }

    quizRestartBtn.onclick = () => {
      quizIndex = 0;
      quizAcertos = 0;
      quizResult.textContent = '';
      quizNextBtn.disabled = true;
      quizNextBtn.hidden = false;
      quizRestartBtn.hidden = true;
      mostrarPergunta();
    };

    // --- Contato ---

    contatoForm.addEventListener('submit', e => {
      e.preventDefault();
      contatoFeedback.textContent = '';
      const nome = contatoForm.nome.value.trim();
      const email = contatoForm.email.value.trim();
      const mensagem = contatoForm.mensagem.value.trim();
      if (nome && email && mensagem) {
        contatoFeedback.textContent = 'Mensagem enviada com sucesso! Entraremos em contato.';
        contatoForm.reset();
      } else {
        contatoFeedback.textContent = 'Por favor, preencha todos os campos.';
      }
    });

    // --- Navega√ß√£o ---

    btnLoja.onclick = () => {
      quizSection.hidden = true;
      contatoSection.hidden = true;
      mainContent.hidden = false;
      renderLoja();
    };

    btnQuiz.onclick = () => {
      iniciarQuiz();
    };

    btnContato.onclick = () => {
      mainContent.hidden = true;
      quizSection.hidden = true;
      contatoSection.hidden = false;
      contatoFeedback.textContent = '';
      contatoForm.reset();
    };

    // --- Acessibilidade ---

    btnIncreaseFont.onclick = () => {
      if (fontSize < 24) {
        fontSize += 2;
        document.documentElement.style.fontSize = fontSize + 'px';
      }
    };

    btnDecreaseFont.onclick = () => {
      if (fontSize > 12) {
        fontSize -= 2;
        document.documentElement.style.fontSize = fontSize + 'px';
      }
    };

    btnContrast.onclick = () => {
      contrasteAtivo = !contrasteAtivo;
      document.body.classList.toggle('alto-contraste', contrasteAtivo);
      btnContrast.setAttribute('aria-pressed', contrasteAtivo);
    };

    btnLibras.onclick = () => {
      librasAtivo = !librasAtivo;
      alert(librasAtivo ? 'Tradu√ß√£o LIBRAS ativada (simula√ß√£o).' : 'Tradu√ß√£o LIBRAS desativada.');
      btnLibras.setAttribute('aria-pressed', librasAtivo);
    };

    btnSom.onclick = () => {
      somAtivo = !somAtivo;
      if (somAtivo) {
        somMato.play();
        btnSom.setAttribute('aria-pressed', 'true');
      } else {
        somMato.pause();
        btnSom.setAttribute('aria-pressed', 'false');
      }
    };

    // --- Carrinho eventos ---

    cartBtn.onclick = abrirCarrinho;
    emptyCartBtn.onclick = esvaziarCarrinho;
    closeCartBtn.onclick = fecharCarrinho;
    checkoutBtn.onclick = finalizarCompra;

    // Fecha di√°logo com ESC
    cartDialog.addEventListener('keydown', e => {
      if (e.key === 'Escape') fecharCarrinho();
    });

    // Inicializa loja
    renderLoja();
    atualizarContadorCarrinho();

  </script>
</body>
</html>
