// script.js

document.addEventListener('DOMContentLoaded', () => {
  // Elementos
  const mainContent = document.getElementById('mainContent');
  const menuButtons = document.querySelectorAll('.menu button');
  const cartBtn = document.getElementById('cartBtn');
  const cartCount = document.getElementById('cartCount');
  const cartDialog = document.getElementById('cartDialog');
  const cartItemsContainer = document.getElementById('cartItems');
  const emptyCartBtn = document.getElementById('emptyCartBtn');
  const closeCartBtn = document.getElementById('closeCartBtn');

  const btnContrast = document.getElementById('btnContrast');
  const btnFontIncrease = document.getElementById('btnFontIncrease');
  const btnFontDecrease = document.getElementById('btnFontDecrease');

  let cart = [];
  let fontSize = 16;
  let contrastOn = false;

  // Quiz perguntas (15 no total)
  const quizQuestions = [
    { question: "Qual destes √© um gr√£o?", options: ["Arroz", "Ma√ß√£", "Leite"], answer: 0 },
    { question: "Qual fruta √© vermelha?", options: ["Banana", "Morango", "Cenoura"], answer: 1 },
    { question: "Qual destes √© um derivado do leite?", options: ["Queijo", "Mel", "P√£o"], answer: 0 },
    { question: "Qual verdura √© usada em saladas?", options: ["Alface", "Tomate", "Batata"], answer: 0 },
    { question: "Qual semente √© muito usada para fazer √≥leo?", options: ["Soja", "Milho", "Feij√£o"], answer: 0 },
    { question: "Qual destes √© uma fruta c√≠trica?", options: ["Laranja", "Ma√ß√£", "Uva"], answer: 0 },
    { question: "Qual destes gr√£os √© usado para fazer p√£o?", options: ["Trigo", "Milho", "Aveia"], answer: 0 },
    { question: "Qual √© o nome do mel produzido pelas abelhas?", options: ["Mel", "N√©ctar", "P√≥len"], answer: 0 },
    { question: "Qual destes vegetais cresce na terra?", options: ["Cenoura", "Ma√ß√£", "Banana"], answer: 0 },
    { question: "Qual √© a semente que usamos para fazer caf√©?", options: ["Caf√©", "Soja", "Milho"], answer: 0 },
    { question: "Qual √© um produto derivado do leite?", options: ["Iogurte", "Mel", "Carne"], answer: 0 },
    { question: "Qual fruta tem vitamina C?", options: ["Laranja", "Cenoura", "Feij√£o"], answer: 0 },
    { question: "Qual gr√£o √© usado para fazer pipoca?", options: ["Milho", "Trigo", "Aveia"], answer: 0 },
    { question: "Qual verdura √© verde e muito usada em saladas?", options: ["Alface", "Cenoura", "Tomate"], answer: 0 },
    { question: "Qual fruta √© pequena e roxa?", options: ["Uva", "Laranja", "Banana"], answer: 0 },
  ];

  let currentQuizIndex = 0;
  let correctAnswers = 0;

  // Fun√ß√£o para mostrar a se√ß√£o selecionada
  function showSection(section) {
    if (section === 'quiz') {
      showQuiz();
    } else if (section === 'contact') {
      showContact();
    } else {
      showProducts(section);
    }
  }

  // Fun√ß√£o para mostrar produtos (exemplo simples)
  function showProducts(category) {
    mainContent.innerHTML = `<h2>${capitalize(category)}</h2><p>Produtos da categoria ${category} ainda em desenvolvimento.</p>`;
    mainContent.focus();
  }

  // Fun√ß√£o para mostrar o contato
  function showContact() {
    mainContent.innerHTML = `
      <h2>Contato</h2>
      <p>Email: contato@estacaodaterra.com.br</p>
      <p>Telefone: (99) 99999-9999</p>
      <p>Endere√ßo: Rua do Campo, 123</p>
    `;
    mainContent.focus();
  }

  // Fun√ß√£o para mostrar o quiz
  function showQuiz() {
    currentQuizIndex = 0;
    correctAnswers = 0;
    renderQuizQuestion();
  }

  // Renderiza a quest√£o atual do quiz
  function renderQuizQuestion() {
    const q = quizQuestions[currentQuizIndex];
    let optionsHTML = '';
    q.options.forEach((opt, i) => {
      optionsHTML += `<button class="quiz-option" data-index="${i}">${opt}</button>`;
    });

    mainContent.innerHTML = `
      <h2>Quiz - Pergunta ${currentQuizIndex + 1} de ${quizQuestions.length}</h2>
      <p>${q.question}</p>
      <div class="quiz-options">${optionsHTML}</div>
      <div id="quiz-feedback" aria-live="assertive" style="margin-top: 1rem;"></div>
    `;

    mainContent.focus();

    // Adiciona evento nas op√ß√µes
    const optionButtons = mainContent.querySelectorAll('.quiz-option');
    optionButtons.forEach(btn => {
      btn.addEventListener('click', () => handleAnswer(parseInt(btn.dataset.index)));
    });
  }

  // Trata a resposta do usu√°rio
  function handleAnswer(selectedIndex) {
    const q = quizQuestions[currentQuizIndex];
    const feedback = mainContent.querySelector('#quiz-feedback');

    if (selectedIndex === q.answer) {
      correctAnswers++;
      feedback.textContent = 'Resposta correta! üéâ';
      triggerConfetti();
    } else {
      feedback.textContent = 'Resposta incorreta.';
    }

    // Desabilita bot√µes para n√£o clicar de novo
    mainContent.querySelectorAll('.quiz-option').forEach(btn => btn.disabled = true);

    // Pr√≥xima quest√£o ap√≥s 2s
    setTimeout(() => {
      currentQuizIndex++;
      if (currentQuizIndex < quizQuestions.length) {
        renderQuizQuestion();
      } else {
        showQuizResult();
      }
    }, 2000);
  }

  // Mostra resultado final do quiz
  function showQuizResult() {
    const percent = Math.round((correctAnswers / quizQuestions.length) * 100);
    mainContent.innerHTML = `
      <h2>Resultado do Quiz</h2>
      <p>Voc√™ acertou ${correctAnswers} de ${quizQuestions.length} perguntas.</p>
      <p>Porcentagem de acertos: ${percent}%</p>
      <button id="restartQuizBtn">Recome√ßar Quiz</button>
    `;
    mainContent.focus();

    document.getElementById('restartQuizBtn').addEventListener('click', () => {
      showQuiz();
    });
  }

  // Fun√ß√£o simples para confetes (feito com emojis)
  function triggerConfetti() {
    // Confetes animados simples
    const confettiContainer = document.createElement('div');
    confettiContainer.style.position = 'fixed';
    confettiContainer.style.top = '0';
    confettiContainer.style.left = '0';
    confettiContainer.style.width = '100%';
    confettiContainer.style.height = '100%';
    confettiContainer.style.pointerEvents = 'none';
    confettiContainer.style.zIndex = '9999';

    for (let i = 0; i < 30; i++) {
      const confetti = document.createElement('div');
      confetti.textContent = 'üéâ';
      confetti.style.position = 'absolute';
      confetti.style.fontSize = `${Math.random() * 20 + 10}px`;
      confetti.style.left = `${Math.random() * window.innerWidth}px`;
      confetti.style.top = `${Math.random() * window.innerHeight}px`;
      confetti.style.opacity = '1';
      confetti.style.transition = 'opacity 1s ease-out';
      confettiContainer.appendChild(confetti);

      setTimeout(() => {
        confetti.style.opacity = '0';
      }, 500);
    }

    document.body.appendChild(confettiContainer);
    setTimeout(() => {
      document.body.removeChild(confettiContainer);
    }, 1500);
  }

  // Fun√ß√£o para capitalizar palavra
  function capitalize(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
  }

  // Menu: troca de se√ß√µes
  menuButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      showSection(btn.dataset.section);
    });
  });

  // Carrinho de compras
  cartBtn.addEventListener('click', () => {
    showCart();
  });

  emptyCartBtn.addEventListener('click', () => {
    cart = [];
    updateCartUI();
  });

  closeCartBtn.addEventListener('click', () => {
    cartDialog.close();
  });

  // Atualiza visual do carrinho
  function updateCartUI() {
    cartCount.textContent = cart.length;
    cartBtn.setAttribute('aria-label', `Carrinho de compras, ${cart.length} itens`);

    if (cart.length === 0) {
      cartItemsContainer.innerHTML = '<p>Carrinho vazio.</p>';
    } else {
      cartItemsContainer.innerHTML = '<ul>' + cart.map(item => `<li>${item}</li>`).join('') + '</ul>';
    }
  }

  function showCart() {
    updateCartUI();
    cartDialog.showModal();
  }

  // Exemplo simples para adicionar item ao carrinho
  function addToCart(item) {
    cart.push(item);
    updateCartUI();
  }

  // Exemplo: adiciona produto clicando menu de produtos (para teste)
  menuButtons.forEach(btn => {
    if (btn.dataset.section !== 'quiz' && btn.dataset.section !== 'contact') {
      btn.addEventListener('dblclick', () => {
        addToCart(`Produto da categoria ${btn.dataset.section}`);
        alert(`Produto da categoria ${btn.dataset.section} adicionado ao carrinho!`);
      });
    }
  });

  // Acessibilidade: contraste
  btnContrast.addEventListener('click', () => {
    contrastOn = !contrastOn;
    document.body.classList.toggle('high-contrast', contrastOn);
    btnContrast.setAttribute('aria-pressed', contrastOn);
  });

  // Acessibilidade: aumento/diminui√ß√£o fonte
  btnFontIncrease.addEventListener('click', () => {
    fontSize = Math.min(fontSize + 2, 24);
    document.documentElement.style.fontSize = fontSize + 'px';
  });
  btnFontDecrease.addEventListener('click', () => {
    fontSize = Math.max(fontSize - 2, 12);
    document.documentElement.style.fontSize = fontSize + 'px';
  });

  // Inicializa com se√ß√£o principal (produtos)
  showSection('grains');
});
