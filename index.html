<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Estação da Terra - Feira Sustentável</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header>
  <h1 tabindex="0">Estação da Terra</h1>
  <nav aria-label="Menu principal">
    <button id="btn-loja" aria-controls="sec-loja" aria-expanded="true">Loja</button>
    <button id="btn-contato" aria-controls="sec-contato" aria-expanded="false">Contato</button>
    <button id="btn-acessibilidade" aria-haspopup="dialog" aria-controls="modal-acessibilidade">Acessibilidade</button>
    <button id="btn-libras" aria-pressed="false" title="Ativar tradução em LIBRAS">LIBRAS</button>
  </nav>
</header>

<main>

  <section id="sec-loja" tabindex="-1" aria-label="Seção loja de produtos">
    <p class="slogan" tabindex="0">Do campo à cidade, colhendo oportunidades</p>
    <div class="loja">

      <article class="categoria" aria-labelledby="cat-leite">
        <h2 id="cat-leite" tabindex="0">Leite e derivados</h2>
        <ul class="produtos" aria-live="polite">
          <li class="produto" tabindex="0">
            <img src="https://via.placeholder.com/80x80?text=Leite" alt="Leite Integral 1L" />
            <div class="produto-info">
              <h3>Leite Integral 1L</h3>
              <p>R$ 5,00</p>
            </div>
            <button class="btn-adicionar" aria-label="Adicionar Leite Integral 1 litro ao carrinho">Adicionar</button>
          </li>
          <li class="produto" tabindex="0">
            <img src="https://via.placeholder.com/80x80?text=Queijo" alt="Queijo Minas" />
            <div class="produto-info">
              <h3>Queijo Minas</h3>
              <p>R$ 20,00</p>
            </div>
            <button class="btn-adicionar" aria-label="Adicionar Queijo Minas ao carrinho">Adicionar</button>
          </li>
        </ul>
      </article>

      <article class="categoria" aria-labelledby="cat-frutas">
        <h2 id="cat-frutas" tabindex="0">Frutas</h2>
        <ul class="produtos" aria-live="polite">
          <li class="produto" tabindex="0">
            <img src="https://via.placeholder.com/80x80?text=Maçã" alt="Maçã Vermelha" />
            <div class="produto-info">
              <h3>Maçã Vermelha</h3>
              <p>R$ 3,50</p>
            </div>
            <button class="btn-adicionar" aria-label="Adicionar Maçã Vermelha ao carrinho">Adicionar</button>
          </li>
          <li class="produto" tabindex="0">
            <img src="https://via.placeholder.com/80x80?text=Banana" alt="Banana Nanica" />
            <div class="produto-info">
              <h3>Banana Nanica</h3>
              <p>R$ 2,80</p>
            </div>
            <button class="btn-adicionar" aria-label="Adicionar Banana Nanica ao carrinho">Adicionar</button>
          </li>
        </ul>
      </article>

      <article class="categoria" aria-labelledby="cat-verduras">
        <h2 id="cat-verduras" tabindex="0">Verduras</h2>
        <ul class="produtos" aria-live="polite">
          <li class="produto" tabindex="0">
            <img src="https://via.placeholder.com/80x80?text=Alface" alt="Alface Crespa" />
            <div class="produto-info">
              <h3>Alface Crespa</h3>
              <p>R$ 2,00</p>
            </div>
            <button class="btn-adicionar" aria-label="Adicionar Alface Crespa ao carrinho">Adicionar</button>
          </li>
          <li class="produto" tabindex="0">
            <img src="https://via.placeholder.com/80x80?text=Cenoura" alt="Cenoura" />
            <div class="produto-info">
              <h3>Cenoura</h3>
              <p>R$ 4,00</p>
            </div>
            <button class="btn-adicionar" aria-label="Adicionar Cenoura ao carrinho">Adicionar</button>
          </li>
        </ul>
      </article>

    </div>
  </section>

  <section id="sec-contato" tabindex="-1" hidden aria-label="Formulário de contato">
    <h2 tabindex="0">Fale conosco</h2>
    <form id="form-contato" aria-describedby="form-desc">
      <p id="form-desc" class="sr-only">Formulário para enviar mensagem para a Estação da Terra</p>
      <label for="nome">Nome:</label>
      <input type="text" id="nome" name="nome" required aria-required="true" />

      <label for="email">E-mail:</label>
      <input type="email" id="email" name="email" required aria-required="true" />

      <label for="mensagem">Mensagem:</label>
      <textarea id="mensagem" name="mensagem" rows="4" required aria-required="true"></textarea>

      <button type="submit">Enviar</button>
    </form>
  </section>

  <!-- Carrinho -->
  <aside class="carrinho" aria-label="Carrinho de compras" tabindex="0">
    <h2 tabindex="0">Seu Carrinho</h2>
    <ul id="lista-carrinho" aria-live="polite" aria-relevant="additions removals"></ul>
    <p id="total-carrinho" tabindex="0">Total: R$ 0,00</p>
    <button id="btn-limpar" disabled>Limpar Carrinho</button>
    <button id="btn-finalizar" disabled>Finalizar Compra</button>
  </aside>

</main>

<!-- Modal acessibilidade -->
<div id="modal-acessibilidade" role="dialog" aria-modal="true" aria-labelledby="modal-title" hidden>
  <div class="modal-content">
    <h2 id="modal-title">Configurações de Acessibilidade</h2>
    <button id="btn-fechar-modal" aria-label="Fechar configurações de acessibilidade">×</button>

    <fieldset>
      <legend>Ajustes visuais</legend>

      <label>
        <input type="checkbox" id="chk-contraste" />
        Alto Contraste
      </label>

      <label>
        <input type="checkbox" id="chk-aumento-fonte" />
        Aumentar Fonte
      </label>

      <label>
        <input type="checkbox" id="chk-diminuir-animacoes" />
        Reduzir Animações
      </label>
    </fieldset>
  </div>
</div>

<!-- Área LIBRAS -->
<div id="balao-libras" aria-live="polite" aria-atomic="true" hidden></div>

<script>
  (() => {
    // Controle do menu e seções
    const btnLoja = document.getElementById("btn-loja");
    const btnContato = document.getElementById("btn-contato");
    const secLoja = document.getElementById("sec-loja");
    const secContato = document.getElementById("sec-contato");

    btnLoja.addEventListener("click", () => {
      btnLoja.setAttribute("aria-expanded", "true");
      btnContato.setAttribute("aria-expanded", "false");
      secLoja.hidden = false;
      secContato.hidden = true;
      secLoja.focus();
    });

    btnContato.addEventListener("click", () => {
      btnContato.setAttribute("aria-expanded", "true");
      btnLoja.setAttribute("aria-expanded", "false");
      secContato.hidden = false;
      secLoja.hidden = true;
      secContato.focus();
    });

    // Carrinho de compras
    const carrinhoLista = document.getElementById("lista-carrinho");
    const totalCarrinho = document.getElementById("total-carrinho");
    const btnLimpar = document.getElementById("btn-limpar");
    const btnFinalizar = document.getElementById("btn-finalizar");

    let carrinho = [];

    function formatarPreco(valor) {
      return valor.toLocaleString("pt-BR", {
        style: "currency",
        currency: "BRL",
      });
    }

    function atualizarCarrinho() {
      carrinhoLista.innerHTML = "";
      let total = 0;
      carrinho.forEach(({ nome, preco, id }, i) => {
        total += preco;
        const li = document.createElement("li");
        li.textContent = `${nome} - ${formatarPreco(preco)}`;

        const btnRemove = document.createElement("button");
        btnRemove.textContent = "Remover";
        btnRemove.setAttribute("aria-label", `Remover ${nome} do carrinho`);
        btnRemove.addEventListener("click", () => {
          carrinho.splice(i, 1);
          atualizarCarrinho();
        });
        li.appendChild(btnRemove);
        carrinhoLista.appendChild(li);
      });
      totalCarrinho.textContent = `Total: ${formatarPreco(total)}`;
      btnLimpar.disabled = carrinho.length === 0;
      btnFinalizar.disabled = carrinho.length === 0;
    }

    // Adicionar produto
    document.querySelectorAll(".btn-adicionar").forEach((btn, idx) => {
      btn.addEventListener("click", (e) => {
        const produtoLi = e.target.closest(".produto");
        const nome = produtoLi.querySelector("h3").textContent;
        const precoStr = produtoLi.querySelector("p").textContent.replace("R$ ", "").replace(",", ".");
        const preco = parseFloat(precoStr);
        const id = idx + 1;

        carrinho.push({ nome, preco, id });
        atualizarCarrinho();

        // Foco no carrinho para acessibilidade
        carrinhoLista.focus();
      });
    });

    btnLimpar.addEventListener("click", () => {
      carrinho = [];
      atualizarCarrinho();
    });

    btnFinalizar.addEventListener("click", () => {
      alert("Compra finalizada com sucesso! Obrigado.");
      carrinho = [];
      atualizarCarrinho();
    });

    // Formulário contato
    const formContato = document.getElementById("form-contato");
    formContato.addEventListener("submit", (e) => {
      e.preventDefault();
      alert("Mensagem enviada com sucesso. Entraremos em contato!");
      formContato.reset();
    });

    // Modal acessibilidade
    const modal = document.getElementById("modal-acessibilidade");
    const btnAcessibilidade = document.getElementById("btn-acessibilidade");
    const btnFecharModal = document.getElementById("btn-fechar-modal");

    btnAcessibilidade.addEventListener("click", () => {
      modal.hidden = false;
      modal.querySelector("h2").focus();
    });

    btnFecharModal.addEventListener("click", () => {
      modal.hidden = true;
      btnAcessibilidade.focus();
    });

    // Fechar modal com ESC
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !modal.hidden) {
        modal.hidden = true;
        btnAcessibilidade.focus();
      }
    });

    // Configurações de acessibilidade
    const chkContraste = document.getElementById("chk-contraste");
    const chkFonte = document.getElementById("chk-aumento-fonte");
    const chkAnimacoes = document.getElementById("chk-diminuir-animacoes");

    chkContraste.addEventListener("change", () => {
      document.body.classList.toggle("alto-contraste", chkContraste.checked);
    });

    chkFonte.addEventListener("change", () => {
      document.body.classList.toggle("fonte-grande", chkFonte.checked);
    });

    chkAnimacoes.addEventListener("change", () => {
      document.body.classList.toggle("animacoes-desativadas", chkAnimacoes.checked);
    });

    // LIBRAS básico: mostra balão com texto "Sinal: nome do produto" ao clicar em LIBRAS
    const btnLibras = document.getElementById("btn-libras");
    const balaoLibras = document.getElementById("balao-libras");

    let librasAtivo = false;
    btnLibras.addEventListener("click", () => {
      librasAtivo = !librasAtivo;
      btnLibras.setAttribute("aria-pressed", librasAtivo);
      if (librasAtivo) {
        balaoLibras.hidden = false;
        balaoLibras.textContent = "Tradução em LIBRAS ativada";
        balaoLibras.style.opacity = "1";
      } else {
        balaoLibras.textContent = "Tradução em LIBRAS desativada";
        setTimeout(() => {
          balaoLibras.style.opacity = "0";
          setTimeout(() => {
            balaoLibras.hidden = true;
            balaoLibras.textContent = "";
          }, 500);
        }, 2000);
      }
    });

    // Quando usuário clica em "Adicionar", se LIBRAS ativado, mostra o balão com o nome do produto em "sinal"
    document.querySelectorAll(".btn-adicionar").forEach((btn) => {
      btn.addEventListener("click", () => {
        if (!librasAtivo) return;
        const produto = btn.closest(".produto").querySelector("h3").textContent;
        balaoLibras.hidden = false;
        balaoLibras.textContent = `Sinal: ${produto}`;
        balaoLibras.style.opacity = "1";
        setTimeout(() => {
          balaoLibras.style.opacity = "0";
          setTimeout(() => {
            balaoLibras.hidden = true;
            balaoLibras.textContent = "";
          }, 500);
        }, 3000);
      });
    });
  })();
</script>

</body>
</html>
